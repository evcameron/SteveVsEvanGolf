<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whistle Post Cup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base Card Styling */
        .score-card { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); border-left-width: 5px; }
        
        /* WINNER GRADIENTS: Fading from white on the left to the winner's color on the right */
        .bg-evan-win  { background: linear-gradient(to right, #ffffff, #eff6ff); } /* To light blue */
        .bg-steve-win { background: linear-gradient(to right, #ffffff, #ecfdf5); } /* To light emerald */
        .bg-draw      { background: #ffffff; }

        /* CATEGORY BORDER COLORS (Left side) */
        .border-dentonia { border-left-color: #f59e0b; }
        .border-18hole   { border-left-color: #3b82f6; }
        .border-9hole    { border-left-color: #8b5cf6; }
        .border-other    { border-left-color: #94a3b8; }

        /* Major Styling */
        .major-card { border-top: 2px solid #fbbf24; border-right: 2px solid #fbbf24; border-bottom: 2px solid #fbbf24; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2); }
        .major-header { background: #fbbf24; color: #78350f; }
        
        /* Header Glassmorphism */
        .header-card { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(4px); }
        #breakdown-container { transition: max-height 0.3s ease-out, opacity 0.2s ease-in-out; overflow: hidden; }
        .collapsed { max-height: 0 !important; opacity: 0; pointer-events: none; }
        .expanded { max-height: 600px; opacity: 1; }
        .chevron { transition: transform 0.3s ease; }
        .rotate-180 { transform: rotate(180deg); }
        .weight-badge { background: rgba(255, 255, 255, 0.1); padding: 1px 4px; border-radius: 3px; color: rgba(255,255,255,0.4); font-size: 7px; }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-900 text-[13px]">

    <header class="bg-green-800 text-white p-4 text-center shadow-lg sticky top-0 z-20">
        <h1 class="text-xl font-black uppercase italic tracking-tighter mb-4">Whistle Post Cup</h1>
        
        <div class="flex flex-col gap-2 max-w-sm mx-auto mb-4">
            <div class="header-card rounded-lg p-3">
                <p class="text-[9px] uppercase tracking-[0.2em] font-bold opacity-70 mb-2">Overall Cup Totals</p>
                <div class="flex justify-around items-center">
                    <div class="text-center">
                        <span class="block text-[10px] font-bold uppercase opacity-60 mb-1">Evan</span>
                        <span id="evan-points" class="text-2xl font-black text-blue-300">--</span>
                    </div>
                    <div class="h-8 w-[1px] bg-white/20"></div>
                    <div class="text-center">
                        <span class="block text-[10px] font-bold uppercase opacity-60 mb-1">Steve</span>
                        <span id="steve-points" class="text-2xl font-black text-emerald-300">--</span>
                    </div>
                </div>
            </div>

            <div class="header-card rounded-lg p-3 text-left">
                <button onclick="toggleBreakdown()" class="w-full flex justify-between items-center focus:outline-none">
                    <p class="text-[9px] uppercase tracking-[0.2em] font-bold opacity-70">Points Breakdown</p>
                    <svg id="chevron-icon" class="chevron w-4 h-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                    </svg>
                </button>
                <div id="breakdown-container" class="expanded">
                    <div class="pt-4 mb-1 flex justify-between text-[7px] uppercase font-black opacity-40 border-b border-white/10 pb-1">
                        <span>CATEGORY / WEIGHT</span>
                        <span class="w-24 text-center">EVAN / STEVE</span>
                    </div>
                    <div id="breakdown-list" class="space-y-1.5 text-[10px] font-bold uppercase"></div>
                </div>
            </div>
        </div>
        <div id="standings" class="flex justify-center gap-4 text-[11px] font-black uppercase tracking-widest text-white/90"></div>
    </header>

    <main class="max-w-md mx-auto p-3">
        <div id="results-list" class="space-y-3">
            <p class="text-center py-10 text-slate-400 italic">Syncing scores...</p>
        </div>
    </main>

    <script>
        const MATCHES_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgE990XAIusYwh-kIJw35ZMFn7_886JopnebL0YFuGCDXVF7wUtIwolZuCZXY62AjBJM2Y7fLhoI-l/pub?output=csv&gid=0';
        const DETAILS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgE990XAIusYwh-kIJw35ZMFn7_886JopnebL0YFuGCDXVF7wUtIwolZuCZXY62AjBJM2Y7fLhoI-l/pub?gid=1591713882&single=true&output=csv';

        function toggleBreakdown() {
            const container = document.getElementById('breakdown-container');
            const icon = document.getElementById('chevron-icon');
            if (container.classList.contains('expanded')) {
                container.classList.replace('expanded', 'collapsed');
                icon.classList.add('rotate-180');
            } else {
                container.classList.replace('collapsed', 'expanded');
                icon.classList.remove('rotate-180');
            }
        }

        async function fetchOverallDetails() {
            try {
                const response = await fetch(DETAILS_URL + '&cb=' + new Date().getTime());
                const data = await response.text();
                const rows = data.split(/\r?\n/).map(row => row.split(','));
                const list = document.getElementById('breakdown-list');
                list.innerHTML = '';
                rows.forEach(col => {
                    const label = col[3]?.replace(/"/g, '').trim(), weight = col[4]?.replace(/"/g, '').trim(); 
                    const ev = col[6]?.replace(/"/g, '').trim(), st = col[7]?.replace(/"/g, '').trim(); 
                    if (!label || label === "Category" || label === "") return;
                    if (label.toLowerCase() === 'total') {
                        document.getElementById('evan-points').innerText = ev;
                        document.getElementById('steve-points').innerText = st;
                    } else {
                        list.innerHTML += `<div class="flex justify-between items-center border-b border-white/5 pb-1"><div class="flex items-center gap-2 pr-2"><span class="opacity-70">${label}</span>${weight ? `<span class="weight-badge">${weight}</span>` : ''}</div><div class="w-24 flex justify-center items-center gap-2 flex-shrink-0"><span class="text-blue-300 font-black w-8 text-right">${ev}</span><span class="text-white/10">|</span><span class="text-emerald-300 font-black w-8 text-left">${st}</span></div></div>`;
                    }
                });
            } catch (e) { console.error(e); }
        }

        async function fetchMatchResults() {
            try {
                const response = await fetch(MATCHES_URL + '&cb=' + new Date().getTime());
                const data = await response.text();
                const rows = data.split(/\r?\n/).map(row => row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
                const container = document.getElementById('results-list');
                const standingsEl = document.getElementById('standings');
                container.innerHTML = '';
                let evWins = 0, stWins = 0;

                rows.slice(1).reverse().forEach(col => {
                    if (col.length < 7) return;
                    const date = col[1]?.trim(), cat = col[2]?.trim(), maj = col[3]?.trim(), course = col[4]?.trim();
                    const evanS = parseInt(col[5]), steveS = parseInt(col[6]), evanH = col[7]?.trim() || "0", steveH = col[8]?.trim() || "0";
                    const win = col[9]?.trim().toLowerCase();
                    if (isNaN(evanS) || isNaN(steveS)) return;
                    if (win.includes('evan')) evWins++; else if (win.includes('steve')) stWins++;
                    
                    const isEvW = win.includes('evan');
                    const isStW = win.includes('steve');

                    // 1. Determine Category Border Color
                    let catClass = 'border-other';
                    if (cat.toLowerCase().includes('dentonia')) catClass = 'border-dentonia';
                    else if (cat.toLowerCase().includes('18')) catClass = 'border-18hole';
                    else if (cat.toLowerCase().includes('9')) catClass = 'border-9hole';

                    // 2. Determine Winner Gradient Class
                    let bgClass = 'bg-draw';
                    if (isEvW) bgClass = 'bg-evan-win';
                    else if (isStW) bgClass = 'bg-steve-win';

                    container.innerHTML += `
                        <div class="flex flex-col">
                            ${maj ? `<div class="flex"><span class="major-header text-[9px] font-black px-2 py-0.5 rounded-t-md uppercase tracking-wider ml-1 italic font-serif">üèÜ ${maj}</span></div>` : ''}
                            <div class="score-card px-3 py-2 flex flex-col ${catClass} ${bgClass} ${maj ? 'major-card' : ''}">
                                <div class="flex justify-between items-center mb-1 border-b border-slate-100 pb-1 text-slate-400">
                                    <span class="text-[9px] font-bold uppercase tracking-tight">${date} ‚Ä¢ ${course}</span>
                                    <span class="text-[9px] font-bold uppercase">${cat}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2 w-[42%]">
                                        <span class="font-bold text-[10px] ${isEvW ? 'text-blue-700' : 'text-slate-300'}">EVAN</span>
                                        <span class="text-xl font-black ${isEvW ? 'text-slate-900' : 'text-slate-300'}">${evanS} <span class="text-[9px] font-medium opacity-40">(${evanH})</span></span>
                                    </div>
                                    <span class="text-slate-200 italic font-bold text-[10px] w-[8%] text-center tracking-tighter">VS</span>
                                    <div class="flex items-center justify-end gap-2 w-[42%] text-right">
                                        <span class="text-xl font-black ${isStW ? 'text-slate-900' : 'text-slate-300'}"><span class="text-[9px] font-medium opacity-40">(${steveH})</span> ${steveS}</span>
                                        <span class="font-bold text-[10px] ${isStW ? 'text-emerald-700' : 'text-slate-300'}">STEVE</span>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                standingsEl.innerHTML = `<div class="bg-blue-600/20 text-blue-300 px-3 py-1 rounded-full border border-blue-500/30 text-[10px]">Evan: ${evWins}</div><div class="bg-emerald-600/20 text-emerald-300 px-3 py-1 rounded-full border border-emerald-500/30 text-[10px]">Steve: ${stWins}</div>`;
            } catch (e) { container.innerHTML = `<p class="text-center text-red-500">Error loading scores.</p>`; }
        }

        fetchOverallDetails();
        fetchMatchResults();
    </script>
</body>
</html>
